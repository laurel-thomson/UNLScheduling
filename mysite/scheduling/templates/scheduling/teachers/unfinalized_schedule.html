{% extends 'in_room_base_teacher.html' %}

{% block room_name %}{{room.name}}{% endblock %}

{% block term_link %}<li class="active"><a href="{% url 'teachers:term_list' room.id %}">Terms</a></li>{% endblock %}
{% block user_link %}<li><a href="{% url 'teachers:user_list' room.id %}">Users</a></li>{% endblock %}
    

{% block content %}

<h2>Term Schedule</h2>
  
    <p>The schedule has not been finalized. <a href="{% url 'teachers:finalize_schedule' room.id term.id %}">&nbsp;Finalize the schedule</a></p>

    <p>
        {% for option in options %}
            <strong><font color="{{option.color_coding}}">{{option}} &nbsp;&nbsp;&nbsp;</font></strong>
        {% endfor %}
    </p>

    {% if messages %}
        {% for message in messages %}
            <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}" role="alert">{{ message }}</div>
        {% endfor %}
    {% endif %}

    {% load crispy_forms_tags %}    

    <form action="{% url 'teachers:update_schedule' room.id term.id %}" method="post">
        {% csrf_token %}
        <table id = "myTable" class="display nowrap">
            <thead style="display:none;">
                <tr>
                    <td>Time Slot</td>
                    <td>Student</td>
                </tr>
            </thead>
            <tbody>
            {% for slot, users in schedule.items %}
                {% for user, user_schedule in users.items %}
                    <tr>
                        <td>
                            {{ slot.day }}: {{ slot.start_time }} - {{ slot.end_time }}
                            <a href="{% url 'teachers:delete_time_slot' room.id term.id slot.id %}" onclick="return confirm('Are you sure you want to delete this time slot?')"> x</a>
                        </td>
                        <td>
                            <label for "{{slot.id}}_{{user.id}}"><font class="{{user.id}} test" color="{{user_schedule.preference.color_coding}}">{{user}}</font></label>
                            <input type="checkbox" onclick="checkSchedule({{user.id}})" class="{{user.id}}" name="{{slot.id}}_{{user.id}}" id="{{slot.id}}_{{user.id}}" {% if user_schedule.is_scheduled %}checked{% endif %}>
                        </td>
                    </tr>
                {% endfor %}
            {% endfor %}
            </tbody>
        </table>
        <br>
        <input type="submit" value="Submit" class="btn btn-primary">
    </form>

    <h2 class="test">Add Time Slot</h2>

    <form action="{% url 'teachers:add_time_slot' room.id term.id %}" method="post">
        {% csrf_token %}
        <table>
            {{ form|crispy }}
        </table>
        <input type="submit" value="Add Time Slot"  class="btn btn-primary">
    </form>

    <br>
    <p><a href="{% url 'teachers:delete_term' room.id term.id %}" onclick="return confirm('Are you sure?')">Delete this Term</a></p>

    {% load static %}
    <script type="text/javascript" src="{% static 'js/table_grouping.js' %}"></script>

    <script type="text/javascript">
        function checkSchedule(user_id) {
            var fonts = document.getElementsByClassName(user_id + " test");
            for (let font of fonts) {
                font.setAttribute("color","gray");
                font.setAttribute("style", "text-decoration: line-through");
            }
        }
    </script>

{% endblock %}